<!DOCTYPE html><html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Roulette ê¸°ëŒ€ê°’ ì¡°ì •ê¸°</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>body{font-family:system-ui,sans-serif}</style>
</head>
<body class="bg-gray-100 min-h-screen p-4">
  <div class="max-w-3xl mx-auto bg-white shadow rounded-lg overflow-hidden">
    <header class="px-6 py-4 border-b bg-white">
      <h1 class="text-2xl font-bold">Roulette ê¸°ëŒ€ê°’ ì¡°ì •ê¸°</h1>
    </header>
    <main class="p-6 space-y-4">
      <div class="flex flex-wrap gap-2">
        <button id="addRow" class="px-3 py-1 bg-green-500 text-white rounded hover:bg-green-600">ê°’ ì¶”ê°€</button>
        <button id="normBtn" class="px-3 py-1 bg-yellow-500 text-white rounded hover:bg-yellow-600">ì •ê·œí™”</button>
        <button id="suggestBtn" class="px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600">í™•ë¥  ì¶”ì²œ</button>
        <button id="calcBtn" class="px-3 py-1 bg-indigo-500 text-white rounded hover:bg-indigo-600">ê³„ì‚°</button>
      </div><section id="msg" class="text-sm"></section>
  <progress id="progressBar" max="100" value="0" class="w-full h-2 bg-gray-200 rounded" style="display:none;"></progress>
  <div id="progressText" class="text-sm text-gray-600" style="display:none;"></div>

  <div class="overflow-x-auto">
    <table id="dataTable" class="w-full text-sm table-auto border-collapse">
      <thead>
        <tr class="bg-gray-200"><th class="border px-2 py-1">ê°’</th><th class="border px-2 py-1">í™•ë¥ (%)</th><th class="border px-2 py-1">ê³ ì •</th><th class="border px-2 py-1">ì‚­ì œ</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <div class="flex gap-4">
    <div><label class="block text-sm font-medium">ëª©í‘œ EV</label><input id="targetEV" type="number" value="4.85" step="0.01" class="border rounded p-1 w-24"></div>
    <div><label class="block text-sm font-medium">í—ˆìš© ì˜¤ì°¨</label><input id="tolerance" type="number" value="0.15" step="0.01" class="border rounded p-1 w-24"></div>
  </div>
  <div class="flex items-center space-x-4">
    <div id="evDisplay" class="text-sm text-gray-700"></div>
    <div id="sumDisplay" class="text-sm text-gray-700"></div>
    <button id="copyAllBtn" class="px-2 py-1 bg-gray-200 rounded text-sm hover:bg-gray-300">ì „ì²´ ë³µì‚¬</button>
  </div>
</main>

  </div><script>
const tbody=document.querySelector('#dataTable tbody');
const msgEl=document.getElementById('msg');
const progressBar=document.getElementById('progressBar');
const progressText=document.getElementById('progressText');
const evDisplay=document.getElementById('evDisplay');
const sumDisplay=document.getElementById('sumDisplay');

// ê¸°ë³¸ í–‰ ì¶”ê°€
addRow(0,10,true);

function addRow(val='',prob='',fixed=false){
  const tr=document.createElement('tr');
  tr.innerHTML=`<td class="border px-2 py-1"><input type="number" value="${val}" class="w-20 border rounded p-1 value-cell"></td><td class="border px-2 py-1"><div class="flex items-center space-x-1"><input type="number" step="0.001" value="${prob}" class="w-20 border rounded p-1 prob-cell"><button onclick="copyProb(this)" class="text-gray-500 hover:text-gray-700 text-sm">ðŸ“‹</button></div></td><td class="border px-2 py-1 text-center"><input type="checkbox" class="fixed-cell" ${fixed?'checked':''}></td><td class="border px-2 py-1 text-center"><button class="delRow text-red-500 hover:text-red-700">âœ•</button></td>`;
  tbody.appendChild(tr);
  attachProbListener(tr.querySelector('.prob-cell'));
  sortRows();
  updateAll();
}

function sortRows(){
  const rows=[...tbody.querySelectorAll('tr')].sort((a,b)=>parseFloat(a.querySelector('.value-cell').value)-parseFloat(b.querySelector('.value-cell').value));
  rows.forEach(r=>tbody.appendChild(r));
}

document.getElementById('addRow').onclick=()=>addRow();

tbody.onclick=e=>{
  if(e.target.classList.contains('delRow')){e.target.closest('tr').remove();updateAll();}
}

function showMsg(t,err=true){msgEl.textContent=t;msgEl.style.color=err?'#c00':'#080';}

// ì •ê·œí™”
function normalize(){let sum=0;document.querySelectorAll('.prob-cell').forEach(i=>sum+=parseFloat(i.value)||0);if(sum<=0){showMsg('ì •ê·œí™”í•  í™•ë¥ ì´ ì—†ìŠµë‹ˆë‹¤.');return;}document.querySelectorAll('.prob-cell').forEach(i=>i.value=((parseFloat(i.value)||0)/sum*100).toFixed(3));sortRows();updateAll();showMsg('ì •ê·œí™” ì™„ë£Œ',false);}document.getElementById('normBtn').onclick=normalize;

// EV í•¨ìˆ˜
function evFor(vals,p0,q){const a=(1-p0)*(1-q)/(1-Math.pow(q,vals.length));return vals.reduce((s,v,i)=>s+a*Math.pow(q,i)*v,0);}

// Bisection root finder for EV target
function solveQ(vals,p0,targetEV,tol){let lo=0.0001,hi=0.9999;let bestQ=lo,bestDiff=Infinity;for(let i=0;i<100;i++){const mid=(lo+hi)/2;const ev=evFor(vals,p0,mid);const diff=Math.abs(ev-targetEV);if(diff<bestDiff){bestDiff=diff;bestQ=mid;}if(diff<=tol)break;ev<targetEV?lo=mid:hi=mid;}return bestQ;}

// í™•ë¥  ì¶”ì²œ
function recommend(){showMsg('');const targetEV=parseFloat(document.getElementById('targetEV').value);const tol=parseFloat(document.getElementById('tolerance').value);const rows=[...tbody.querySelectorAll('tr')];const fixed=[],vals=[];rows.forEach(r=>{const v=parseFloat(r.querySelector('.value-cell').value);const p=(parseFloat(r.querySelector('.prob-cell').value)||0)/100;(r.querySelector('.fixed-cell').checked?fixed:vals).push(r.querySelector('.fixed-cell').checked?{v,p}:v);});if(!vals.length){showMsg('ì¶”ì²œí•  ê°’ì´ ì—†ìŠµë‹ˆë‹¤.');return;}const p0=(fixed.find(r=>r.v===0)?.p)||0;const q=solveQ(vals,p0,targetEV,tol);const a=(1-p0)*(1-q)/(1-Math.pow(q,vals.length));const raw=vals.map((v,i)=>a*Math.pow(q,i)*100);const need3=raw.some(p=>p<0.01);const dec=need3?3:2;let prefs=raw.map(p=>Math.max(need3?0.001:0,parseFloat(p.toFixed(dec))));const fixedSum=fixed.reduce((s,r)=>s+r.p,0)*100;const adjust=100-fixedSum-prefs.reduce((s,p)=>s+p,0);if(prefs.length)prefs[0]+=adjust;let idx=0;rows.forEach(r=>{if(!r.querySelector('.fixed-cell').checked)r.querySelector('.prob-cell').value=prefs[idx++].toFixed(dec);});sortRows();updateAll();showMsg('ì¶”ì²œ ì™„ë£Œ',false);}

document.getElementById('suggestBtn').onclick=recommend;document.getElementById('calcBtn').onclick=()=>{sortRows();updateAll();};

// ì‹¤ì‹œê°„ í‘œì‹œunction updateSum(){let s=0;document.querySelectorAll('.prob-cell').forEach(i=>s+=parseFloat(i.value)||0);sumDisplay.textContent=`Î£p â‰ˆ ${s.toFixed(3)}%`;}
function updateEV(){let ev=0;document.querySelectorAll('#dataTable tbody tr').forEach(tr=>{const v=parseFloat(tr.querySelector('.value-cell').value)||0;const p=parseFloat(tr.querySelector('.prob-cell').value)||0;ev+=v*(p/100);});evDisplay.textContent=`ê¸°ëŒ“ê°’ â‰ˆ ${ev.toFixed(4)}`;}
function updateAll(){updateEV();updateSum();}

function attachProbListener(inp){inp.oninput=()=>{updateAll();};}
function attachProbListeners(){document.querySelectorAll('.prob-cell').forEach(attachProbListener);}attachProbListeners();
window.addEventListener('DOMContentLoaded',updateAll);

function copyProb(btn){navigator.clipboard.writeText(btn.previousElementSibling.value+'%').then(()=>showMsg('ë³µì‚¬ë¨',false));}

document.getElementById('copyAllBtn').onclick=()=>{let t='';document.querySelectorAll('#dataTable tbody tr').forEach(tr=>{t+=`${tr.querySelector('.value-cell').value}: ${tr.querySelector('.prob-cell').value}%\n`;});navigator.clipboard.writeText(t).then(()=>showMsg('ì „ì²´ ë³µì‚¬ ì™„ë£Œ',false));};
</script></body>
</html>
